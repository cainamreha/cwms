$(document).ready(function(){$('body').on("dblclick",".fileName",function(e){e.preventDefault();if($(this).siblings('.editButtons-panel').find('.rename').length){$(this).siblings('.editButtons-panel').find('.rename.dialog').click();}return false;});$('body').on("click",".dialog",function(e){e.preventDefault();e.stopImmediatePropagation();var editTarget;var editID;var editFolder;var dialogType;dialogType=$(this).attr('data-dialog');editTarget=$(this).attr('data-dialogname');editID=$(this).attr('data-dialogid');if(typeof($.fn.dialog)=="function"){$.createDialog(dialogType);$("#dialog-form-"+dialogType).dialog("open").siblings('.ui-dialog-buttonpane').find("button").addClass('cc-button button').parent('div').children("button:first-child").addClass('change').prepend('<span class="cc-admin-icons cc-icons cc-icon-ok">&nbsp;</span>').parent('div').children("button:last-child").addClass('cancel').prepend('<span class="cc-admin-icons cc-icons cc-icon-cancel">&nbsp;</span>').closest(".ui-dialog").find(".dialogInput").val(editTarget).siblings('.copyID').val(editID).closest(".ui-dialog").find('.cc-admin-icons:not(:first-child)').remove();}if(dialogType=="gallery"){head.ready("ui",function(){head.ready("tagEditor",function(){$.getGalleryTagEditor(editTarget);});});}return false;});$("body").on("keypress",".ui-dialog",function(e){if(e.keyCode===$.ui.keyCode.ENTER){var focusElem=$("*:focus");if(!(focusElem.hasClass("ui-dialog-titlebar-close")||focusElem.hasClass("cancel"))){$(this).find('.ui-dialog-buttonpane').find('button:first-child').click();}else{$(this).find('.ui-dialog-buttonpane').find('button:last-child').click();}return false;}});});(function($){$.createDialog=function(formExt){if(!$("#dialog-form-"+formExt).length||!$(".dialog").length){return false;}var newNameInput,allFields,tips,buttonLabels,okLabel,cancelLabel,dialogButtons;function getDialogVars(){newNameInput=$("#newname-"+formExt),allFields=$([]).add(newNameInput),tips=$(".validateTips");buttonLabels=$('#buttonLabels-'+formExt).val().split("<>");okLabel=buttonLabels[0];cancelLabel=buttonLabels[1];dialogButtons=new Array();}getDialogVars();function updateTips(t){tips.text(t)}function checkLength(o,n,min,max,notice){if(o.val().length>max||o.val().length<min){if(o.val().length>max){tip=notice[1];}else{tip=notice[0];}updateTips(tip);return false;}else{return true;}}function checkRegexp(o,regexp,n){if(!(regexp.exec(o.val()))){updateTips(n);return false;}else{return true;}}$("#dialog-form-"+formExt).dialog({autoOpen:false,minHeight:Math.max(parseInt(($(window).width())>1200?350:300),300),minWidth:Math.max(parseInt(($(window).width())>1200?450:350),350),position:{my:"center",at:"center center-16%",of:window},modal:true,zIndex:9500,open:function(){$(".validateTips").html("");},buttons:{Ok:function getOkButton(){getDialogVars();var phrases=$('#phrases-'+formExt).val().split("<>");var okButton=phrases[1];var folderName="";var dbUpdate=0;var bValid=true;allFields.removeClass("ui-state-error");bValid=bValid&&checkLength(newNameInput,"newname-"+formExt,1,64,phrases);if($('#foldername-'+formExt).length){folderName=$('#foldername-'+formExt).val();bValid=bValid&&checkRegexp(newNameInput,/^([0-9a-z._-])+$/i,phrases[2].split("<br />")[0]);bValid=bValid&&checkRegexp(newNameInput,/^[0-9a-z]([0-9a-z._-]+)$/i,phrases[2].split("<br />")[0]);if($('#dbUpdate-'+formExt).length&&$('#dbUpdate-'+formExt).is(':checked')){dbUpdate=1;}}else{bValid=bValid&&checkRegexp(newNameInput,/^([0-9a-z _-])+$/i,phrases[2].split("<br />")[0]);bValid=bValid&&checkRegexp(newNameInput,/^[0-9a-z]([0-9a-z _-]+)$/i,phrases[2].split("<br />")[0]);}if(bValid){var editName=$('#oldname-'+formExt).val();var newName=newNameInput.val().replace(/ /g,"_");var dialogObject=$(this);var notGallery=dialogObject.hasClass('copy');var tags="";if(newName==editName&&notGallery){$(this).dialog("close");return false;}var targetURL=$('#scriptpath-'+formExt).val();targetURL+=folderName+"&editname="+editName+"&newname="+newName+"&dbupdate="+dbUpdate;if(!notGallery){tags=$('input[name="gall_tags"]').val();targetURL+='&tags='+tags;}$.ajax({url:targetURL,contentType:'application/json; charset=utf-8',dataType:"json",success:function(ajax){if(typeof(ajax)!="object"){updateTips(phrases[4]);return false;}var result=ajax.result;if(result=="1"){var newHrefEdit="";var newHrefDel="";var editListN=$('#editlist-'+editName);var delListN=$('#dellist-'+editName);var className=editListN.attr('class').split("date-");var iniLetter=newName.charAt(0).toUpperCase();var iconTag=editListN.find('.openList').children('.cc-admin-icons').clone();newHrefEdit=editListN.find('.showListBox').attr('data-url').replace("=gallery&gal="+editName,"=gallery&gal="+newName);newHrefDel=delListN.find('.showListBox').attr('data-url').replace("action=del&type=gallery&gal="+editName,"action=del&type=gallery&gal="+newName);$('#oldname-'+formExt).val(newName);editListN.find('.showListBox').attr('data-url',newHrefEdit);editListN.find('.openList').val(newName).html(newName).prepend(iconTag.clone());editListN.attr('class','listItem gallListItem '+iniLetter+' date-'+className[1]);editListN.find('.changeGallName').attr('data-dialogname',newName);editListN.attr('id','editlist-'+newName);editListN.find('[data-content="tags"]').html(tags);delListN.find('.showListBox').attr('data-url',newHrefDel);delListN.find('.openList').val(newName).html(newName).prepend(iconTag.clone());delListN.attr('class','listItem gallListItem '+iniLetter+' date-'+className[1]);delListN.find('.changeGallName').attr('data-dialogname',newName);delListN.attr('id','dellist-'+newName);delListN.find('[data-content="tags"]').html(tags);dialogObject.dialog("close");return false;}if(result=="-1"){updateTips(phrases[3]);return false;}if(result=="2"){var listBox=$('.changeFileName').closest('.listBox');var mediaList=$('*[data-id="'+listBox.attr('data-id')+'"]');dialogObject.dialog("close");$.removeListBox();$.removeWaitBar();mediaList.find('.showListBox[data-type="gallery"]:first').click();return false;}dialogObject.dialog("close");if(result!="1111111111111"){jAlert(result,conciseCMS.ln.alerttitle);return false;}$.doAjaxAction(cc.httpRoot+'/admin?task=forms&tab=1',true);return false;updateTips(phrases[4]);return false;}});}},abbrechen:function getCancelButton(){$(this).dialog("close");}},close:function(){allFields.removeClass("ui-state-error").val("");}});};$.getGalleryTagEditor=function(gallName){var fetchTagsScript=cc.httpRoot+"/system/access/editGalleries.php?action=galltags&type=gallery&gal="+gallName;var currTags=[];$.ajax({url:fetchTagsScript,contentType:'application/json; charset=utf-8',dataType:"json",success:function(ajax){currTags=ajax.tags.split(",");$('#gall_tags').tagEditor("destroy").tagEditor({maxLength:2048,initialTags:currTags,forceLowercase:false,delimiter:",;\n",autocomplete:{position:{collision:"flip"},source:cc.httpRoot+"/system/access/editGalleries.php?action=allgalltags&type=gallery&gal="+gallName,delay:0,minLength:0,create:function(event,ui){}},onChange:function(field,editor,tags){}});}});};})(jQuery);